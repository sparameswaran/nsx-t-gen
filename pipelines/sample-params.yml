enable_ansible_debug: false # set value to true for verbose output from ansible

vcenter_host: vcsa-01.corp.local.io       # EDIT
vcenter_usr: administrator@vsphere.local  # EDIT
vcenter_pwd: 39adladfasdfl!               # EDIT
vcenter_datacenter: Datacenter            # EDIT
vcenter_datastore: Datastore              # EDIT
vcenter_cluster: Cluster                  # EDIT
vcenter_manager: vcenter-1                # EDIT
ntpservers: 10.13.12.2                    # EDIT
mgmt_portgroup: 'VM Network'              # EDIT
dnsserver: 10.13.12.2                     # EDIT
dnsdomain: corp.local.io                  # EDIT
defaultgateway: 10.13.12.1                # EDIT
netmask: 255.255.255.0                    # EDIT

# Download NSX-T 2.1 bits from
# https://my.vmware.com/group/vmware/details?downloadGroup=NSX-T-210&productId=673
# Host a Webserver to serve the ova images and ovftool
# Please edit the endpoint and the file names
nsx_image_webserver: http://10.85.24.5:9080/
nsx_mgr_ova: nsx-unified-appliance-2.1.0.0.0.7395503.ova  
nsx_controller_ova: nsx-controller-2.1.0.0.0.7395493.ova  
nsx_edge_ova: nsx-edge-2.1.0.0.0.7395502.ova  
ovftool_image: VMware-ovftool-4.2.0-5965791-lin.x86_64.bundle

# Specify passwd of the esxi hosts that should be used for nsx-t
esxi_hosts_root_pwd: rootPasswd  # EDIT - Root password for the esxi hosts

# Specify FQDN, ip (and passwd if they are different) for each of the esxi hosts that should be used for nsx-t
esxi_hosts_config: |
  esxi_hosts:
  - name: esxi-host1.corp.local.io
    ip: 10.13.12.10
    root_pwd: rootPasswd 
# - name: esxi-host2.corp.local.io
#   ip: 10.13.12.11
#   root_pwd: rootPasswd 

# Edit fololowing parameters
nsx_t_manager_fqdn: nsx-t-mgr.corp.local.io
nsx_t_manager_host_name: 'nsx-t-mgr' # Without spaces
nsx_t_manager_vm_name: 'NSX-T Mgr'   # Can have spaces
nsx_t_manager_ip: 10.13.12.50
nsx_t_manager_admin_user: admin
nsx_t_manager_admin_pwd: VMware1!         # Min 8 chars, upper, lower, number, special digit
nsx_t_manager_root_pwd: VMware1!          # Min 8 chars, upper, lower, number, special digit
nsx_t_controller_host_prefix: nsx-t-ctl   # Without spaces, Generated controller would be nsx-t-ctrl-1.corp.local.io,...
nsx_t_controller_vm_name_prefix: 'NSX-T Controller' # Generated edge host name would be "NSX-T Controller-1"
nsx_t_controller_ips: 10.13.12.51,10.13.12.52,10.13.12.53 # Should be 1 or 3 ips to maintain quorum for Controller Cluster
nsx_t_controller_root_pwd: VMware1!       # Min 8 chars, upper, lower, number, special digit
nsx_t_controller_cluster_pwd: VMware1!    # Min 8 chars, upper, lower, number, special digit
nsx_t_edge_host_prefix: nsx-t-edge        # Without spaces, generated edge would be nsx-t-edge-1.corp.local.io,...
nsx_t_edge_vm_name_prefix: 'NSX-T Edge'   # Generated edge host name would be "NSX-T Edge-1"
nsx_t_edge_ips: 10.13.12.54,10.13.12.55   # comma separated ips, requires min 2 for HA
nsx_t_edge_root_pwd: VMware1!
nsx_t_edge_portgroup_ext: vlan3032        # For external routing
nsx_t_edge_portgroup_transport: vlan3127  # For TEP/overlay

# Edge network interfaces
# Network1 and Network4 are for mgmt and not used for uplink
# Network2 is for external uplink
# Network3 is for overlay
# Change only if necessary
nsx_t_edge_overlay_interface: fp-eth1 # Wired to Network3
nsx_t_edge_uplink_interface: fp-eth0  # Wired to Network2

# Tunnel endpoint network ip pool
nsx_t_tep_pool_name: tep-ip-pool
nsx_t_tep_pool_cidr: 192.168.213.0/24
nsx_t_tep_pool_gateway: 192.168.213.1
nsx_t_tep_pool_start: 192.168.213.10
nsx_t_tep_pool_end: 192.168.213.200
nsx_t_tep_pool_nameserver: 192.168.213.2

# Memory reservation is turned ON by default with the NSX-T OVAs.
# This would mean a deployment of an edge or a mgr would reserve full memory
# leading to memory constraints
# if nsx_t_keep_reservation to true  - would keep reservation ON, recommended for production setups.
# if nsx_t_keep_reservation to false - would turn reservation OFF, recommended for POCs, smaller setups. 
nsx_t_keep_reservation: true # for Prod setup

# Default Sizing of NSX-T VMs
# Manager Sizing
# small  : 2 vCPU,  8GB RAM
# medium : 4 vCPU, 16GB RAM - default with OVA
# large  : 8 vCPU, 32GB RAM
# Controller Sizing
# default: 4 vCPU, 16GB RAM
# Edge Instance Sizing
# small  : 2 vCPU,  4GB RAM - Too small - dont use
# medium : 4 vCPU,  8GB RAM - default with OVA
# large  : 8 vCPU, 16GB RAM

# Controller is fixed to the 4 vCPU and 16 GB RAM
# Change default size for deployment for edge and mgr
nsx_t_mgr_deploy_size: small   # recommended for POCs, smaller setup
nsx_t_edge_deploy_size: medium # recommended for POCs, smaller setup

# More control over memory and vcpu to use
# Not exposed
# nsx_t_sizing_spec: |
#   nsx_t_sizing:
#     mgr:
#       cpu: 2
#       memory: 8192 # in MB, needs to be multiples of 1024
#     controller:
#       # Controller would be resized from 4vCPU/16GB to 2vCPU/8GB
#       cpu: 2
#       memory: 8192 # in MB, needs to be multiples of 1024
#     edge:
#       cpu: 2
#       memory: 8192 # in MB, needs to be multiples of 1024


nsx_t_overlay_hostswitch: hostswitch2
nsx_t_vlan_hostswitch: hostswitch1

# For Edge External uplink
nsx_t_transport_vlan: 0

nsx_t_vlan_transport_zone: vlan-tz
nsx_t_overlay_transport_zone: overlay-tz

nsx_t_pas_ncp_cluster_tag: pas1

nsx_t_edge_cluster: 'Edge Cluster'

# For outbound uplink connection used by Edge
nsx_t_single_uplink_profile_name: "single-uplink-profile"
nsx_t_single_uplink_profile_mtu: 1600 # Min 1600
nsx_t_single_uplink_profile_vlan: 0 # Default

# For internal overlay connection used by Edge & Esxi hosts
nsx_t_overlay_profile_name: "host-overlay-profile"
nsx_t_overlay_profile_mtu: 1600 # Min 1600
nsx_t_overlay_profile_vlan: 0

# Specify a free vmnic on esxi host to be used for nsx-t
# can be multiple vmnics separated by comma
nsx_t_esxi_vmnics: vmnic1 # vmnic1,vmnic2...

# Configs for T0Router (only one per run), T1Routers, Logical switches and tags...
# Make sure the ncp/cluster tag matches the one defined at the top level.
# Expects to use atleast 2 edge instances for HA
nsx_t_t0router_spec: |
  t0_router:
    name: DefaultT0Router
    edge_index: nsx-t-edge-01
    ha_mode: 'ACTIVE_STANDBY'
    vip: 10.13.12.103/27
    ip1: 10.13.12.101/27
    ip2: 10.13.12.102/27
    vlan_uplink: 0
    static_route:
      next_hop: 10.13.12.1
      network: 0.0.0.0/0
      admin_distance: 1
    tags:
      ncp/cluster: 'pas1' # Should match the top level ncp/cluster tag value
      testtag: 'testpas1'

# T1 Logical Router with associated logical switches
# Add additional or comment off unnecessary t1 routers and switches as needed
# Can have 3 different setups:
# 1: One shared mgmt T1 Router and infra logical switch for both PKS & PAS
# 2: One mgmt T1 Router and infra logical switch for either PKS or PAS.. 
#    Comment off the T1 router not required
# 3: Separate mgmt T1 Router and infra logical switch for each PKS and PAS.. 
#    Add additional T1Router-Mgmt2 as needed with its infra logical switch
# Name the routers and logical switches and cidrs differently to avoid conflict
nsx_t_t1router_logical_switches_spec: |
  t1_routers:
  # Add additional T1 Routers or collapse switches into same T1 Router as needed
  # Comment off the following T1 Routers if there is no PAS
  - name: T1-Router-PAS-Infra
    switches:
    - name: PAS-Infra
      subnet_ip: 192.168.10.1 # Last octet should be 1 rather than 0
      subnet_mask: 26

  - name: T1-Router-PAS-ERT
    switches:
    - name: PAS-ERT
      subnet_ip: 192.168.24.1 # Last octet should be 1 rather than 0
      subnet_mask: 26

  - name: T1-Router-PAS-Services
    switches:
    - name: PAS-Services
      subnet_ip: 192.168.28.1 # Last octet should be 1 rather than 0
      subnet_mask: 26

  - name: T1-Router-PAS-DynamicServices
    switches:
    - name: PAS-DynamicServices
      subnet_ip: 192.168.30.1 # Last octet should be 1 rather than 0
      subnet_mask: 22

  # Comment off the following T1 Routers if there is no PKS
  - name: T1-Router-PKS-Infra
    switches:
    - name: PKS-Deployment
      subnet_ip: 192.168.20.1 # Last octet should be 1 rather than 0
      subnet_mask: 22

  - name: T1Router-PKS-Clusters
    switches:
    - name: PKS-PKS-Clusters
      subnet_ip: 192.168.40.1 # Last octet should be 1 rather than 0
      subnet_mask: 22


# Make sure the ncp/cluster tag matches the one defined on the T0 Router
# Additional the ncp/ha tag should be set for HA Spoof guard profile
nsx_t_ha_switching_profile_spec: |
  ha_switching_profiles:
  - name: HASwitchingProfile
    tags:
      ncp/cluster: 'pas1'  # Should match the top level ncp/cluster tag value
      ncp/ha: 'true'       # Required for HA
      testtag: 'testpas1'


# Make sure the ncp/cluster tag matches the one defined on the T0 Router
# Add additional container ip blocks as needed
nsx_t_container_ip_block_spec: |
  container_ip_blocks:
  - name: container-ip-block
    cidr: 10.4.0.0/16    
    tags:
      ncp/cluster: 'pas1' # Should match the top level ncp/cluster tag value
      testtag: 'testpas1' 
 

# Make sure the ncp/cluster tag matches the one defined on the T0 Router for PAS
# Make sure the ncp/shared tag is set to true for PKS
# Additional the ncp/external tag should be set for external facing ip pool
# Add additional exernal ip pools as needed
nsx_t_external_ip_pool_spec: |
  external_ip_pools:
  - name: external-ip-pool-for-pas
    cidr: 10.100.0.0/24
    gateway: 10.100.0.1
    start: 10.100.0.10 # Should not include gateway
    end: 10.100.0.200  # Should not include gateway
    tags:
      ncp/cluster: 'pas1'   # Should match the top level ncp/cluster tag value for PAS
      ncp/external: 'true'  # Required for external facing ips
      testtag: 'testpas1'      
  - name: external-ip-pool-for-pks
    cidr: 10.200.0.0/24
    gateway: 10.200.0.1
    start: 10.200.0.10 # Should not include gateway
    end: 10.200.0.200  # Should not include gateway
    tags:
      # Needs to have atleast one tag entry
      ncp/external: 'true'  # Required for external facing ips
      ncp/shared: 'true'    # Required for PKS

# Specify NAT rules
# Provide matching dnat and snat rule for specific vms by using ips for destination_network and translated_network that need to be exposed like Ops Mgr
# Provide snat rules for outbound from either container or a vm by specifying the source_network (cidr) and translated network ip
nsx_t_nat_rules_spec: |
  nat_rules:

  # Sample entries for allowing inbound to Ops Mgr or some exposed service running on private network
  # - t0_router: DefaultT0Router
  #   nat_type: dnat
  #   destination_network: 10.13.12.81   # External IP exposed
  #   translated_network: 192.168.10.5     # Internal IP of VM (like ops mgr) on one of the logical switches
  #   rule_priority: 1024                  # Higher priority
  # # Sample entry for allowing outbound from Ops Mgr to external
  # - t0_router: DefaultT0Router
  #   nat_type: snat
  #   source_network: 192.168.10.5         # This would be a VM (like ops mgr) on one of the logical switches
  #   translated_network: 10.13.12.81    # Would appear to outside as coming from 10.193.162.81
  #   rule_priority: 1024                  # Higher priority
  # # Sample entry for allowing container ip to go outbound external
  # - t0_router: DefaultT0Router
  #   nat_type: snat
  #   source_network: 10.4.0.0/20          # IP cidr should match the container ip block cidr
  #   translated_network: 10.13.12.101  
  #   rule_priority: 8000                  # Lower priority
  # # Sample entry for allowing internal vm to go outbound external
  # - t0_router: DefaultT0Router
  #   nat_type: snat
  #   source_network: 192.168.0.0/16       # IP cidr should match one or more logical switches cidr
  #   translated_network: 10.13.12.111
  #   rule_priority: 8001                  # Lower priority

  # Sample entry for allowing inbound to PAS Ops manager
  - t0_router: DefaultT0Router
    nat_type: dnat
    destination_network: 10.13.12.2   # External IP address for PAS opsmanager
    translated_network: 192.168.10.2     # Internal IP of PAS Ops manager
    rule_priority: 1024                  # Higher priority
  # Sample entry for allowing outbound from PAS Ops Mgr to external
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.10.2         # Internal IP of PAS opsmanager
    translated_network: 10.13.12.2      # External IP address for PAS opsmanager
    rule_priority: 1024                  # Higher priority
  # Sample entry for PAS Infra network SNAT
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.10.0/24      # PAS Infra network cidr
    translated_network: 10.13.12.3      # SNAT External Address for PAS networks
    rule_priority: 8000                  # Lower priority

  # Sample entry for PAS ERT network SNAT
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.24.0/24      # PAS ERT network cidr
    translated_network: 10.13.12.3      # SNAT External Address for PAS networks
    rule_priority: 8000                  # Lower priority

  # Sample entry for PAS Services network SNAT
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.28.0/24      # PAS Services network cidr
    translated_network: 10.13.12.3      # SNAT External Address for PAS networks
    rule_priority: 8001                  # Lower priority

  # Sample entry for PAS Dynamic Services network SNAT
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.30.0/24      # PAS Dynamic Services network cidr
    translated_network: 10.13.12.3      # SNAT External Address for PAS networks
    rule_priority: 8001                  # Lower priority

  # Sample entry for PKS PKS-Clusters network
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.40.0/24      # PKS Clusters network cidr
    translated_network: 10.13.12.6       # SNAT External Address for PKS networks
    rule_priority: 8001                  # Lower priority

  # Sample entry for PKS PKS-Infra network
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.20.0/24      # PKS Infra network cidr
    translated_network: 10.13.12.6       # SNAT External Address for PKS networks
    rule_priority: 8001                  # Lower priority

  # Sample entry for allowing inbound to PKS Ops manager
  - t0_router: DefaultT0Router
    nat_type: dnat
    destination_network: 10.13.12.5      # External IP address for PKS opsmanager
    translated_network: 192.168.20.2     # Internal IP of PKS Ops manager
    rule_priority: 1024                  # Higher priority
  # Sample entry for allowing outbound from PKS Ops Mgr to external
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.20.2         # Internal IP of PAS opsmanager
    translated_network: 10.13.12.5       # External IP address for PAS opsmanager
    rule_priority: 1024                  # Higher priority

  # Sample entry for allowing inbound to PKS Controller
  - t0_router: DefaultT0Router
    nat_type: dnat
    destination_network: 10.13.12.7      # External IP address for PKS controller
    translated_network: 192.168.20.4     # Internal IP of PKS Ops Controller
    rule_priority: 1024                  # Higher priority
  # Sample entry for allowing outbound from PKS Controller to external
  - t0_router: DefaultT0Router
    nat_type: snat
    source_network: 192.168.20.4        # Internal IP of PKS controller
    translated_network: 10.13.12.7      # External IP address for PKS controller
    rule_priority: 1024                 # Higher priority
  
nsx_t_csr_request_spec: |
  csr_request:
    #common_name not required - would use nsx_t_manager_fqdn
    org_name: Company            # EDIT
    org_unit: net-integ          # EDIT
    country: US                  # EDIT
    state: CA                    # EDIT
    city: SF                     # EDIT
    key_size: 2048               # Valid values: 2048 or 3072
    algorithm: RSA               # Valid values: RSA or DSA

# LBR definition
# By default, all the server pools would use Layer 4 - TCP pass through
# No ssl termination or handling, uses default tcp active monitor & auto map for virtual server
# Auto Map mode uses LB interface IP and ephemeral port. 
# In scenarios where both Clients and Pool Members are attached to the same Logical Router, 
# SNAT (Auto Map or IP List) must be used.

# LBR Sizing guide 
# LB Size | Virtual Servers | Pool Members
# small   |   10            |   30
# medium  |  100            |  300
# large   | 1000            | 3000

# No. of LBs per edge
# Edge Size| Small LBs| Medium LBs| Large LBs
# small    |    0     |   0       | 0
# medium   |    1     |   0       | 0
# large    |    4     |   1       | 1
# Bare metal - not covered here

nsx_t_lbr_spec: |
  loadbalancers:
  # Sample entry for creating LBR for PAS ERT
  - name: PAS-ERT-LBR
    t1_router: T1-Router-PAS-ERT # Should match a previously declared T1 Router
    size: small                  # Allowed sizes: small, medium, large
    virtual_servers:
    - name: goRouter443         # Name that signifies function being exposed
      vip: 10.13.12.150         # Exposed VIP for LBR to listen on
      port: 443
      members:
      - ip: 192.168.24.31       # Internal ip of GoRouter instance 1
        port: 443
      - ip: 192.168.24.32       # Internal ip of GoRouter instance 2
        port: 443
    - name: goRouter80
      vip: 10.13.12.150
      port: 80
      members:
      - ip: 192.168.24.31       # Internal ip of GoRouter instance 1
        port: 80
      - ip: 192.168.24.32       # Internal ip of GoRouter instance 2
        port: 80 
    - name: sshProxy            # SSH Proxy exposed to outside
      vip: 10.13.12.151         
      port: 2222                # Port 2222 for ssh proxy
      members:
      - ip: 192.168.24.41       # Internal ip of Diego Brain where ssh proxy runs
        port: 2222